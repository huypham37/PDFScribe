# Comprehensive Plan: PDFScribe (Native macOS)

**Goal:** Create a production-ready, minimalist native macOS application for splitting screen PDF reading and markdown note-taking, featuring auto-quoting and an AI sidebar.

**Tech Stack:**
*   **Core:** Swift 6.0, SwiftUI.
*   **PDF Engine:** `PDFKit` (Native).
*   **Editor:** `NSTextView` (Native, wrapped in SwiftUI) for performance and rich text capabilities.
*   **Build System:** Swift Package Manager (SPM).

## 1. Project Initialization & Scaffolding
*   **Action:** Initialize Git repository.
*   **Action:** Create `.gitignore` specifically for Swift/Xcode (`.build/`, `.swiftpm/`, `*.xcodeproj/`).
*   **Action:** Initialize Swift Package: `swift package init --type executable --name PDFScribe`.
*   **Action:** Define `Package.swift` to require macOS 12.0+ platform capabilities.

## 2. Architecture (MVVM)
*   **Models:**
    *   `DocumentModel`: Holds the reference to the PDF URL and the Note content string.
*   **ViewModels:**
    *   `AppViewModel`: The source of truth. Manages the 3-pane layout state and current document paths.
    *   `PDFViewModel`: Handles `PDFView` events (page changes, text selection).
    *   `EditorViewModel`: Manages the text buffer and the "Insert Quote" logic.
*   **Views:**
    *   `MainSplitView`: Uses `HSplitView` to render [PDF | Editor | AI].
    *   `PDFPanel`: A `NSViewRepresentable` wrapper around `PDFView`.
    *   `EditorPanel`: A `NSViewRepresentable` wrapper around `NSTextView`.

## 3. Core Features Implementation Steps

**Step 1: The Shell**
*   Create the main window with a toolbar (Open File, Toggle AI, Settings).
*   Implement `NSSplitView` logic to ensure the PDF and Editor take up the majority of the screen.

**Step 2: PDF Handling (`PDFPanel`)**
*   Implement `load(url:)` in the ViewModel.
*   **Crucial:** Add `NotificationCenter` observers for `PDFViewSelectionChanged`.
*   When text is selected, store it in `PDFViewModel.selectedText`.

**Step 3: The Editor & Auto-Quote (`EditorPanel`)**
*   Implement a standard Markdown editor with syntax highlighting (basic implementation initially).
*   **Feature:** "Highlight to Quote".
    *   Detect text selection in PDF.
    *   Show a floating button OR automatically append to the editor (user configurable, default: Auto).
    *   Append format: `> "Selected Text" [Page N]\n\n`.

**Step 4: AI Sidebar (`AIPanel`)**
*   Create a clean, vertical chat UI (ScrollView + VStacks).
*   Input field at the bottom.
*   Mock the API response initially to ensure UI fluidity, then add `URLSession` code for OpenAI/Anthropic.

**Step 5: Persistence & Production Polish**
*   **Auto-Save:** Observe changes in `EditorViewModel` and debounce writes to the `.md` file on disk.
*   **Auto-Associate:** When opening `doc.pdf`, check for `doc.md`. If it exists, load it. If not, create it.
*   **Bundling:** Create a `Makefile` to compile the swift package and copy it into a valid `PDFScribe.app` bundle structure with a default icon.

## 4. Verification Plan
*   Run `swift build` to ensure no compilation errors.
*   Run `swift run` to launch the app.
*   **Manual Test:** Open a PDF -> Highlight Text -> Verify it appears in the Note panel.
