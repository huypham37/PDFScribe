# ACTIVE MEMORY: Issue #51

## Link
https://github.com/huypham37/PDFScribe/issues/51

## Description
Enable progressive rendering of AI messages as they stream in, with automatic scrolling to follow the content generation.

### Tasks from Issue
- [ ] Hook up AIService streaming to UI layer
- [ ] Display message chunks progressively as they arrive
- [x] Implement auto-scroll that follows content generation
- [x] Add smooth scroll animations (not jarring jumps)
- [ ] Handle user manual scroll (pause auto-scroll)
- [ ] Resume auto-scroll when user scrolls to bottom

## Progress Log

### [2026-01-18 Session] Auto-scroll Implementation

**Work Done:**
- Implemented auto-scroll to position new Q&A pairs at top of viewport
- Changed scroll target from assistant response to user query (scroll to `messages[count-2]` instead of last message)
- Added invisible anchor views (`Color.clear.frame(height:1).id("anchor-{queryId}")`) for precise scroll positioning
- Changed ForEach loop structure to use pairIndex calculation for better ID handling
- Added 32pt top padding to ALL query sections (not just first) for breathing room
- Used `withAnimation(.easeInOut(duration: 0.4))` for smooth scrolling
- Added 150ms delay before scroll to ensure view renders

**Files Modified:**
- `PDFScribe/View/Components/ReportView.swift`:
  - Restructured ForEach to use `pairIndex * 2` calculation
  - Added invisible anchor views before each query section
  - Updated scroll logic to target anchor IDs
  - Added debug logging for troubleshooting

**Decisions:**
- Used anchor-based scrolling because `.id()` on the view itself wasn't providing precise scroll positioning
- Added delay (150ms) to ensure SwiftUI has rendered the new content before scrolling
- Changed from `.spring()` to `.easeInOut()` animation for more predictable behavior

**Current Status: IN PROGRESS**
- Scroll IS being triggered correctly (confirmed via debug logs)
- Scroll target is correct (targeting the new query's anchor)
- Issue: Old content still visible above new query - scroll may not be positioning at absolute top
- Need to verify if anchor-based approach solves the positioning issue

**Next Steps:**
- Test anchor-based scrolling approach
- If still not working, consider alternative: add minimum height to Q&A sections
- Remove debug logging once working
- Commit and merge to main
